<!DOCTYPE html>
<html>
<head>
  <title>Track Location</title>
</head>
<body>
  <h2>üìç Capturing location... hang tight!</h2>

  <!-- Firebase SDK v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id") || "anonymous";

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          try {
            await db.collection("clicks").add({
              id: id,
              timestamp: new Date(),
              latitude: lat,
              longitude: lon
            });

            document.body.innerHTML = `<h3>‚úÖ Location saved!<br>Lat: ${lat}, Lon: ${lon}</h3>`;
          } catch (err) {
            console.error("Firestore error:", err);
            document.body.innerHTML = `<p>‚ùå Error saving location. See console.</p>`;
          }
        },
        (error) => {
          console.error("Geolocation failed:", error);
          document.body.innerHTML = `
            <p>‚ùå Failed to fetch location.</p>
            <p>${error.message}</p>
          `;
        }
      );
    } else {
      document.body.innerHTML = "<p>‚ùå Geolocation is not supported in this browser.</p>";
    }
  </script>
</body>
</html>
