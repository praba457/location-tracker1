<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial; }
    iframe { width: 300px; height: 200px; border: 0; }
    .entry {
      margin-bottom: 30px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 15px;
    }
  </style>
</head>
<body>
  <h2>Visitor Logs with Map</h2>
  <div id="logs">Loading...</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    function createMap(lat, lon) {
      return `<iframe
        loading="lazy"
        allowfullscreen
        src="https://maps.google.com/maps?q=${lat},${lon}&z=15&output=embed"></iframe>`;
    }

    function createShareLink(data) {
      const text = `üß≠ Visitor Log:
ID: ${data.id}
Map: https://maps.google.com/maps?q=${data.latitude},${data.longitude}`;
      return `https://wa.me/?text=${encodeURIComponent(text)}`;
    }

    db.collection("clicks").orderBy("timestamp", "desc").get().then(snapshot => {
      const container = document.getElementById("logs");
      container.innerHTML = ""; // Clear "Loading..."

      snapshot.forEach(doc => {
        const data = doc.data();
        const time = new Date(data.timestamp.toDate()).toLocaleString();

        const entry = document.createElement("div");
        entry.classList.add("entry");
        entry.innerHTML = `
          <strong>ID:</strong> ${data.id}<br>
          <strong>Time:</strong> ${time}<br>
          <strong>Lat:</strong> ${data.latitude}<br>
          <strong>Lon:</strong> ${data.longitude}<br><br>
          ${createMap(data.latitude, data.longitude)}<br><br>
          <a href="${createShareLink(data)}" target="_blank">üì§ Share via WhatsApp</a>
        `;
        container.appendChild(entry);
      });
    }).catch(err => {
      document.getElementById("logs").innerHTML = "‚ùå Error loading data.";
      console.error(err);
    });
  </script>
</body>
</html>
